{% extends "layout.html" %}

{% load static %}
{% block title %} {{reserve.name}} {% endblock %}

{% block head %}
  <link rel="stylesheet" href="{% static 'reserves.css' %}" />
{% endblock %}

{% block body %}
<main class="reserve-detail">
  <header class="reserve-detail__header">
    <h1 class="reserve-detail__title">{{ reserve.name }}</h1>
    <p class="reserve-detail__description">{{ reserve.description|linebreaks }}</p>
  </header>

  <section class="reserve-detail__birds">
    <h2 class="reserve-detail__subtitle">Aves que se pueden observar</h2>
    <ul class="reserve-detail__bird-list">
      {% for bird in birds %}
      <li class="reserve-detail__bird-item">
        <article class="bird-in-reserve">
          {% if bird.photo %}
            <img class="bird-in-reserve__image" src="{{ bird.photo.image.url }}" alt="Foto de {{ bird.common_name }}">
          {% else %}
            <img class="bird-in-reserve__image" src="{% static 'images/no_bird_photo.png' %}" alt="Sin foto disponible">
          {% endif %}
          <div class="bird-in-reserve__info">
            <a class="bird-in-reserve__name" href="{% url 'bird_detail' bird.slug %}">{{ bird.common_name }}</a>
            <span class="bird-in-reserve__scientific">{{ bird.scientific_name }}</span>
          </div>
        </article>
      </li>
      {% empty %}
      <li class="reserve-detail__bird-item">
        No se han registrado aves para esta reserva.
      </li>
      {% endfor %}
    </ul>
  </section>

  <section class="reserve-detail__photos">
    <h2 class="reserve-detail__subtitle">Fotos de la reserva</h2>
    <div id="photoswipe-gallery" class="reserve-detail__photo-grid">
      {% for photo in photos %}
      <a
        href="{{ photo.image.url }}"
        data-pswp-width="1024"
        data-pswp-height="768"
        class="reserve-detail__photo-item"
      >
        <img src="{{ photo.image.url }}" alt="{{ photo.description }}" />
        {% if photo.description %}
        <figcaption>{{ photo.description }}</figcaption>
        {% endif %}
      </a>
      {% empty %}
      <div class="reserve-detail__photo-item">
        <img src="{% static 'images/no_bird_photo.png' %}" alt="Sin foto disponible" />
        <figcaption>Sin descripci√≥n</figcaption>
      </div>
      {% endfor %}
    </div>
  </section>

<!-- PhotoSwipe 5 -->
<link
  rel="stylesheet"
  href="https://unpkg.com/photoswipe@5/dist/photoswipe.css"
/>
<script type="module">
  import PhotoSwipeLightbox from "https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js";

  const lightbox = new PhotoSwipeLightbox({
    gallery: "#photoswipe-gallery",
    children: "a",
    pswpModule: () =>
      import("https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js"),
  });
  lightbox.init();
</script>

</main>
{% endblock %}
